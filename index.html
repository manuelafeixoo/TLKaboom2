<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kaboom 2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Open+Sans:wght@600&display=swap" rel="stylesheet">
    <style>
        :root {
            --peach: #FFAC6E; --cream: #FFF4B5; --mint: #8ED193; --dark-mint: #5A8F5E;
            --soft-red: #FF8A8A; --board-orange: #FFAC6E;
            --bg-gradient: linear-gradient(135deg, #FFF5E1 0%, #E8F5E9 100%);
        }

        body { margin: 0; font-family: 'Open Sans', sans-serif; background: var(--bg-gradient); display: flex;
        flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }

        #setup-screen, #game-screen, #end-game { text-align: center; width: 100%; max-width: 850px; box-sizing: border-box; }
        #setup-screen { padding: 20px; overflow-y: auto; height: 100vh; }
        #game-screen, #end-game { display: none; padding: 10px; }

        .setup-section { background: rgba(255, 255, 255, 0.7); padding: 15px; border-radius: 20px; margin-bottom: 15px; border: 2px solid white; backdrop-filter: blur(5px); }
        h1 { font-family: 'Fredoka One'; color: var(--peach); margin: 5px; font-size: 2.5rem; }
        
        .team-label { font-family: 'Fredoka One'; color: var(--dark-mint); margin-top: 10px; font-size: 1.1rem; text-transform: uppercase; }

        .unit-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 10px; }
        .unit-btn { background: white; border: 2px solid var(--peach); padding: 8px 18px; border-radius: 12px; cursor: pointer; color: var(--peach); font-weight: bold; font-size: 0.95rem; }
        .unit-btn.selected { background: var(--peach); color: white; transform: scale(1.05); }

        .mascot-box { padding: 8px; border: 2px solid #EEE; border-radius: 12px; cursor: pointer; background: white; display: inline-block; margin: 3px; font-size: 1.8rem; }
        .mascot-box.selected { border-color: var(--peach); background: var(--cream); transform: scale(1.1); }

        .start-btn { background: var(--mint); color: white; font-family: 'Fredoka One'; font-size: 1.5rem; padding: 12px 50px; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 0 var(--dark-mint); margin-top: 10px; }

        .scoreboard { display: flex; justify-content: space-around; gap: 10px; margin-bottom: 10px; }
        .team-box { flex: 1; padding: 10px; border-radius: 20px; background: rgba(255,255,255,0.8); border: 2px solid white; display: flex; align-items: center; justify-content: center; gap: 15px; }
        .team-box.active { background: #D1EAD3; border-color: var(--mint); transform: scale(1.03); }
        .score { font-family: 'Fredoka One'; font-size: 1.8rem; color: var(--dark-mint); margin: 0; }

        .sticks-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 15px; background: var(--board-orange); border-radius: 25px; border: 6px solid white; }
        .stick { background: var(--cream); height: 75px; border-radius: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-family: 'Fredoka One'; color: var(--peach); border: 2px solid #F0D38A; }
        .stick.used { visibility: hidden; }

        #timer-container { width: 100%; height: 8px; background: rgba(0,0,0,0.05); border-radius: 10px; margin: 10px 0; overflow: hidden; display: none; }
        #timer-bar { width: 100%; height: 100%; background: var(--mint); transition: width 0.1s linear; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px); align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: white; padding: 25px; border-radius: 40px; max-width: 500px; width: 85%; text-align: center; border: 3px solid var(--cream); }
        .badge { background: var(--peach); color: white; padding: 5px 15px; border-radius: 10px; font-size: 0.8rem; text-transform: uppercase; }
        .question-text { font-size: 1.3rem; font-weight: bold; margin: 20px 0; color: #444; line-height: 1.4; }
        .ans-box { display: none; background: #F8FDF9; padding: 15px; border-radius: 15px; border: 2px solid var(--mint); color: var(--dark-mint); margin: 15px 0; font-weight: bold; }
        .btn-reveal { background: var(--peach); color: white; border: none; padding: 10px 20px; border-radius: 15px; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-action { border: none; padding: 10px 20px; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; flex: 1; }
    </style>
</head>
<body>

<div id="setup-screen">
    <h1>Kaboom 2 üí£</h1>
    <div class="setup-section">
        <div class="team-label">Team 1 Mascot</div>
        <div id="gridM1"></div> 
        <div class="team-label">Team 2 Mascot</div>
        <div id="gridM2"></div>
    </div>
    <div class="setup-section">
        <div class="unit-grid" id="unitGrid"></div>
    </div>
    <button class="start-btn" onclick="startGame()">START GAME</button>
</div>

<div id="game-screen">
    <div class="scoreboard">
        <div id="t1" class="team-box active">
            <div style="display:flex; flex-direction:column; align-items:center;">
                <small style="font-weight:bold; color:var(--dark-mint)">TEAM 1</small>
                <span id="dispM1" style="font-size:2rem"></span>
            </div>
            <div class="score" id="s1">0</div>
        </div>
        <div id="t2" class="team-box">
            <div style="display:flex; flex-direction:column; align-items:center;">
                <small style="font-weight:bold; color:var(--dark-mint)">TEAM 2</small>
                <span id="dispM2" style="font-size:2rem"></span>
            </div>
            <div class="score" id="s2">0</div>
        </div>
    </div>
    <div id="timer-container"><div id="timer-bar"></div></div>
    <div class="sticks-grid" id="sticks"></div>
</div>

<div class="modal" id="modal">
    <div class="modal-content" id="mContent"></div>
</div>

<div id="end-game">
    <div style="font-family:'Fredoka One'; color:var(--mint); font-size:3.5rem; margin-top: 50px;">WELL DONE! ‚ú®</div>
    <div id="winMascot" style="font-size:6rem"></div>
    <h2 id="winnerName" style="font-family:'Fredoka One'; color:var(--peach); font-size:2.5rem;"></h2>
    <p id="finalScore" style="font-weight:bold; font-size:1.5rem;"></p>
    <button class="start-btn" onclick="location.reload()">REPLAY</button>
</div>

<script>
/* 1. VOCABULARIO TL2 */
const vocab = [
    // Unit 1
    {en:"It‚Äôs on the table", es:"Est√° sobre la mesa.", cat:"Unit 1"},
    {en:"It‚Äôs under the window", es:"Est√° debajo de la ventana.", cat:"Unit 1"},
    {en:"It‚Äôs behind the door", es:"Est√° detr√°s de la puerta.", cat:"Unit 1"},
    {en:"It‚Äôs in the school bag", es:"Est√° en la mochila.", cat:"Unit 1"},
    {en:"It‚Äôs on the bookcase", es:"Est√° en la estanter√≠a.", cat:"Unit 1"},
    {en:"It‚Äôs in the cupboard", es:"Est√° en el armario.", cat:"Unit 1"},
    {en:"Where‚Äôs the pencil?", es:"¬øD√≥nde est√° el l√°piz?", cat:"Unit 1"},
    {en:"The pencil is under the rug", es:"El l√°piz est√° debajo de la alfombra.", cat:"Unit 1"},
    {en:"Where‚Äôs the plant?", es:"¬øD√≥nde est√° la planta?", cat:"Unit 1"},
    {en:"The plant is on the chair", es:"La planta est√° sobre la silla.", cat:"Unit 1"},
    {en:"Where‚Äôs the car?", es:"¬øD√≥nde est√° el coche?", cat:"Unit 1"},
    {en:"The car is in the cupboard", es:"El coche est√° en el armario.", cat:"Unit 1"},
    {en:"Where‚Äôs the book?", es:"¬øD√≥nde est√° el libro?", cat:"Unit 1"},
    {en:"The book is in the bookcase", es:"El libro est√° en la estanter√≠a.", cat:"Unit 1"},
    {en:"Where‚Äôs the doll?", es:"¬øD√≥nde est√° la mu√±eca?", cat:"Unit 1"},
    {en:"The doll is in the hall", es:"La mu√±eca est√° en el recibidor.", cat:"Unit 1"},
    {en:"The girl is in the bedroom", es:"La ni√±a est√° en el dormitorio.", cat:"Unit 1"},
    {en:"The dog is in the garden", es:"El perro est√° en el jard√≠n.", cat:"Unit 1"},
    {en:"Mum is in the living room", es:"Mam√° est√° en el sal√≥n.", cat:"Unit 1"},
    {en:"Dad is in the bathroom", es:"Pap√° est√° en el ba√±o.", cat:"Unit 1"},
    // Unit 2
    {en:"I can play the guitar", es:"S√© tocar la guitarra.", cat:"Unit 2"},
    {en:"I can do karate", es:"S√© hacer k√°rate.", cat:"Unit 2"},
    {en:"I can paint", es:"S√© pintar.", cat:"Unit 2"},
    {en:"I can juggle", es:"S√© hacer malabares.", cat:"Unit 2"},
    {en:"I can‚Äôt ride a bike", es:"No s√© montar en bici.", cat:"Unit 2"},
    {en:"I can‚Äôt sing", es:"No s√© cantar.", cat:"Unit 2"},
    {en:"I can‚Äôt dance", es:"No s√© bailar.", cat:"Unit 2"},
    {en:"I can‚Äôt make models", es:"No s√© hacer maquetas.", cat:"Unit 2"},
    {en:"Can you ride a bike? Yes, I can", es:"¬øSabes montar en bici? S√≠.", cat:"Unit 2"},
    {en:"Can you do karate? No, I can¬¥t", es:"¬øSabes hacer k√°rate? No.", cat:"Unit 2"},
    {en:"Can you paint? Yes, I can", es:"¬øSabes pintar? S√≠.", cat:"Unit 2"},
    {en:"Can you play the guitar? No, I can‚Äôt", es:"¬øSabes tocar la guitarra? No.", cat:"Unit 2"},
    {en:"Can you juggle? Yes, I can", es:"¬øSabes hacer malabares? S√≠.", cat:"Unit 2"},
    {en:"Can you sing? No, I can‚Äôt", es:"¬øSabes cantar? No.", cat:"Unit 2"},
    {en:"Can you dance? Yes, I can", es:"¬øSabes bailar? S√≠.", cat:"Unit 2"},
    {en:"Can you make models? No, I can‚Äôt", es:"¬øSabes hacer maquetas? No.", cat:"Unit 2"},
    {en:"I can swim", es:"S√© nadar.", cat:"Unit 2"},
    {en:"I can jump", es:"S√© saltar.", cat:"Unit 2"},
    {en:"I can run", es:"S√© correr.", cat:"Unit 2"},
    {en:"I can turn around", es:"S√© dar la vuelta.", cat:"Unit 2"},
    // Unit 3
    {en:"What are you wearing?", es:"¬øQu√© llevas puesto?", cat:"Unit 3"},
    {en:"I am wearing a pink dress", es:"Llevo un vestido rosa.", cat:"Unit 3"},
    {en:"I am wearing a red hat", es:"Llevo un sombrero rojo.", cat:"Unit 3"},
    {en:"I am wearing a yellow T-shirt", es:"Llevo una camiseta amarilla.", cat:"Unit 3"},
    {en:"I am wearing a brown coat", es:"Llevo un abrigo marr√≥n.", cat:"Unit 3"},
    {en:"I‚Äôm wearing a yellow shirt", es:"Llevo una camisa amarilla.", cat:"Unit 3"},
    {en:"I‚Äôm wearing a white jumper", es:"Llevo un jersey blanco.", cat:"Unit 3"},
    {en:"I‚Äôm wearing a purple skirt", es:"Llevo una falda morada.", cat:"Unit 3"},
    {en:"I‚Äôm wearing black trousers", es:"Llevo pantalones negros.", cat:"Unit 3"},
    {en:"I‚Äôm wearing blue jeans", es:"Llevo vaqueros azules.", cat:"Unit 3"},
    {en:"I‚Äôm wearing green shorts", es:"Llevo pantalones cortos verdes.", cat:"Unit 3"},
    {en:"I‚Äôm wearing grey shoes", es:"Llevo zapatos grises.", cat:"Unit 3"},
    {en:"I‚Äôm wearing a coat and a dress", es:"Llevo un abrigo y un vestido.", cat:"Unit 3"},
    {en:"I‚Äôm wearing a hat and jeans", es:"Llevo un sombrero y vaqueros.", cat:"Unit 3"},
    {en:"I‚Äôm wearing trousers and a jacket", es:"Llevo pantalones y una chaqueta.", cat:"Unit 3"},
    {en:"It is sunny", es:"Hace sol.", cat:"Unit 3"},
    {en:"It is cloudy", es:"Est√° nublado.", cat:"Unit 3"},
    {en:"It‚Äôs raining", es:"Est√° lloviendo.", cat:"Unit 3"},
    {en:"It‚Äôs snowing", es:"Est√° nevando.", cat:"Unit 3"},
    {en:"It‚Äôs windy", es:"Hace viento.", cat:"Unit 3"},
    // Unit 4
    {en:"It‚Äôs a red bird", es:"Es un p√°jaro rojo.", cat:"Unit 4"},
    {en:"It‚Äôs a blue butterfly", es:"Es una mariposa azul.", cat:"Unit 4"},
    {en:"It‚Äôs a brown squirrel", es:"Es una ardilla marr√≥n.", cat:"Unit 4"},
    {en:"It‚Äôs a white duck", es:"Es un pato blanco.", cat:"Unit 4"},
    {en:"It‚Äôs a green frog", es:"Es una rana verde.", cat:"Unit 4"},
    {en:"It‚Äôs a big lizard", es:"Es un lagarto grande.", cat:"Unit 4"},
    {en:"It‚Äôs a small bat", es:"Es un murci√©lago peque√±o.", cat:"Unit 4"},
    {en:"It‚Äôs a small hedgehog", es:"Es un erizo peque√±o.", cat:"Unit 4"},
    {en:"A bat can fly", es:"Un murci√©lago puede volar.", cat:"Unit 4"},
    {en:"A squirrel can climb", es:"Una ardilla puede trepar.", cat:"Unit 4"},
    {en:"A bird can‚Äôt swim", es:"Un p√°jaro no puede nadar.", cat:"Unit 4"},
    {en:"It can run", es:"Puede correr.", cat:"Unit 4"},
    {en:"It can sing", es:"Puede cantar.", cat:"Unit 4"},
    {en:"It can‚Äôt jump", es:"No puede saltar.", cat:"Unit 4"},
    {en:"It can‚Äôt swim", es:"No puede nadar.", cat:"Unit 4"},
    {en:"Can it run? Yes, it can", es:"¬øPuede correr? S√≠.", cat:"Unit 4"},
    {en:"Can it fly? No, it can‚Äôt", es:"¬øPuede volar? No.", cat:"Unit 4"},
    {en:"Can it sing? Yes, it can", es:"¬øPuede cantar? S√≠.", cat:"Unit 4"},
    {en:"Can it swim? Yes, it can", es:"¬øPuede nadar? S√≠.", cat:"Unit 4"},
    {en:"Can it jump? No, it can‚Äôt", es:"¬øPuede saltar? No.", cat:"Unit 4"},
    // Unit 5
    {en:"I am fast", es:"Soy r√°pido/a.", cat:"Unit 5"},
    {en:"I am scary", es:"Doy miedo.", cat:"Unit 5"},
    {en:"I am clever", es:"Soy listo/a.", cat:"Unit 5"},
    {en:"I am tall", es:"Soy alto/a.", cat:"Unit 5"},
    {en:"He is strong", es:"√âl es fuerte.", cat:"Unit 5"},
    {en:"He is thin", es:"√âl es delgado.", cat:"Unit 5"},
    {en:"He is invisible", es:"√âl es invisible.", cat:"Unit 5"},
    {en:"He is fast", es:"√âl es r√°pido.", cat:"Unit 5"},
    {en:"She is scary", es:"Ella da miedo.", cat:"Unit 5"},
    {en:"She is clever", es:"Ella es lista.", cat:"Unit 5"},
    {en:"She is tall", es:"Ella es alta.", cat:"Unit 5"},
    {en:"She is short", es:"Ella es baja.", cat:"Unit 5"},
    {en:"Is he strong? Yes, he is", es:"¬øEs √©l fuerte? S√≠.", cat:"Unit 5"},
    {en:"Is she thin? Yes, she is", es:"¬øEs ella delgada? S√≠.", cat:"Unit 5"},
    {en:"Is she invisible? No, she isn‚Äôt", es:"¬øEs ella invisible? No.", cat:"Unit 5"},
    {en:"Is he scary? No, he isn‚Äôt", es:"¬øDa √©l miedo? No.", cat:"Unit 5"},
    {en:"She is wearing red boots", es:"Ella lleva botas rojas.", cat:"Unit 5"},
    {en:"He is wearing a black belt", es:"√âl lleva un cintur√≥n negro.", cat:"Unit 5"},
    {en:"She is wearing a yellow cape", es:"Ella lleva una capa amarilla.", cat:"Unit 5"},
    {en:"I am wearing a blue mask", es:"Llevo una m√°scara azul.", cat:"Unit 5"},
    // Unit 6
    {en:"What are you doing?", es:"¬øQu√© est√°s haciendo?", cat:"Unit 6"},
    {en:"I am talking", es:"Estoy hablando.", cat:"Unit 6"},
    {en:"I am drinking water", es:"Estoy bebiendo agua.", cat:"Unit 6"},
    {en:"I am eating a banana", es:"Estoy comiendo un pl√°tano.", cat:"Unit 6"},
    {en:"I‚Äôm reading a book", es:"Estoy leyendo un libro.", cat:"Unit 6"},
    {en:"I‚Äôm taking photos", es:"Estoy sacando fotos.", cat:"Unit 6"},
    {en:"I‚Äôm listening to music", es:"Estoy escuchando m√∫sica.", cat:"Unit 6"},
    {en:"I‚Äôm drawing a monster", es:"Estoy dibujando un monstruo.", cat:"Unit 6"},
    {en:"I‚Äôm writing my name", es:"Estoy escribiendo mi nombre.", cat:"Unit 6"},
    {en:"He‚Äôs talking", es:"√âl est√° hablando.", cat:"Unit 6"},
    {en:"He‚Äôs drinking milk", es:"√âl est√° bebiendo leche.", cat:"Unit 6"},
    {en:"She‚Äôs eating a pizza", es:"Ella est√° comiendo una pizza.", cat:"Unit 6"},
    {en:"She‚Äôs reading a comic", es:"Ella est√° leyendo un c√≥mic.", cat:"Unit 6"},
    {en:"He‚Äôs taking photos", es:"√âl est√° sacando fotos.", cat:"Unit 6"},
    {en:"She‚Äôs listening to music", es:"Ella est√° escuchando m√∫sica.", cat:"Unit 6"},
    {en:"He‚Äôs drawing a house", es:"√âl est√° dibujando una casa.", cat:"Unit 6"},
    {en:"She‚Äôs swimming", es:"Ella est√° nadando.", cat:"Unit 6"},
    {en:"She‚Äôs jumping", es:"Ella est√° saltando.", cat:"Unit 6"},
    {en:"He‚Äôs running", es:"√âl est√° corriendo.", cat:"Unit 6"},
    {en:"He‚Äôs dancing", es:"√âl est√° bailando.", cat:"Unit 6"}
];

const mascots = ["ü¶ä","üêº","ü§ñ","ü¶ñ","ü¶Ñ","ü¶Å","üêØ","üê∂"];
let teamChoices = ["ü¶ä", "üêº"], selectedUnits = [], teamScores = [0, 0], activeTeam = 0, cardsOpened = 0, timerInt;

function initSetup() {
    const grid1 = document.getElementById('gridM1'), grid2 = document.getElementById('gridM2');
    mascots.forEach(m => {
        const d1 = document.createElement('div'); d1.className = 'mascot-box'; d1.innerHTML = `<span>${m}</span>`;
        d1.onclick = () => { teamChoices[0]=m; grid1.querySelectorAll('.mascot-box').forEach(x=>x.classList.remove('selected')); d1.classList.add('selected'); };
        grid1.appendChild(d1);
        const d2 = document.createElement('div'); d2.className = 'mascot-box'; d2.innerHTML = `<span>${m}</span>`;
        d2.onclick = () => { teamChoices[1]=m; grid2.querySelectorAll('.mascot-box').forEach(x=>x.classList.remove('selected')); d2.classList.add('selected'); };
        grid2.appendChild(d2);
    });
    const categories = [...new Set(vocab.map(v => v.cat))];
    categories.forEach(n => {
        const b = document.createElement('div'); b.className = 'unit-btn'; b.innerText = n;
        b.onclick = () => { b.classList.toggle('selected'); toggleUnit(n); };
        document.getElementById('unitGrid').appendChild(b);
    });
}

function toggleUnit(n) { selectedUnits.includes(n) ? selectedUnits = selectedUnits.filter(x=>x!==n) : selectedUnits.push(n); }
function shuffle(a) { for (let i=a.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [a[i], a[j]]=[a[j], a[i]]; } }

function startGame() {
    let filtered = vocab.filter(v => selectedUnits.includes(v.cat));
    if(filtered.length < 16) return alert("Select at least 1 unit!");
    shuffle(filtered);
    let selectedQ = filtered.slice(0, 16);
    
    // 6 Tipos equilibrados: 3 de ES, EN, ORDER, FILL y 2 de NEG, FIX
    const types = ['ES','EN','ORDER','FILL','NEG','FIX'];
    let questionModes = [];
    for(let i=0; i<3; i++) { questionModes.push('ES', 'EN', 'ORDER', 'FILL'); }
    for(let i=0; i<2; i++) { questionModes.push('NEG', 'FIX'); }
    shuffle(questionModes);

    let deck = selectedQ.map((v, i) => ({ type: 'q', data: v, mode: questionModes[i] }));
    deck.push({type:'swap'}, {type:'win10'}, {type:'win25'}, {type:'give'});
    shuffle(deck);

    document.getElementById('setup-screen').style.display='none';
    document.getElementById('game-screen').style.display='block';
    document.getElementById('dispM1').innerText=teamChoices[0];
    document.getElementById('dispM2').innerText=teamChoices[1];
    deck.forEach((card, i) => {
        const s = document.createElement('div'); s.className = 'stick'; s.innerText = i+1;
        s.onclick = () => openCard(card, s); document.getElementById('sticks').appendChild(s);
    });
}

function openCard(card, el) {
    if(el.classList.contains('used')) return;
    cardsOpened++; el.classList.add('used');
    const m = document.getElementById('modal'), content = document.getElementById('mContent');
    m.style.display = 'flex';
    if(card.type === 'q') {
        const chall = getChall(card.data, card.mode);
        startTimer();
        content.innerHTML = `<span class="badge">${chall.type}</span><div class="question-text">${chall.q}</div>
            <button class="btn-reveal" id="rev" onclick="showAns()">REVEAL ANSWER</button><div class="ans-box" id="ans">${chall.a}</div>
            <div class="modal-actions" id="acts" style="display:none; gap:10px; justify-content:center; margin-top:15px;">
                <button class="btn-action" style="background:var(--soft-red)" onclick="handleResult(false)">‚ùå WRONG</button>
                <button class="btn-action" style="background:var(--mint)" onclick="handleResult(true)">‚úÖ CORRECT</button>
            </div>`;
    } else { handleSpecial(card.type, content); }
}

function startTimer() {
    const bar = document.getElementById('timer-bar'); document.getElementById('timer-container').style.display='block';
    let w = 100; clearInterval(timerInt);
    timerInt = setInterval(() => { w-=0.5; bar.style.width=w+'%'; if(w<=0) { clearInterval(timerInt); showAns(); } }, 75);
}

function getChall(item, mode) {
    if(mode==='ES') return {type:"Spanish", q:item.en, a:item.es};
    if(mode==='EN') return {type:"English", q:item.es, a:item.en};
    if(mode==='ORDER') return {type:"Unscramble", q:item.en.split(' ').sort(()=>Math.random()-0.5).join(' / '), a:item.en};
    if(mode==='NEG') return {type:"Negative", q:item.en, a: "(Check: can't / isn't / am not / aren't...)"};
    if(mode==='FILL') {
        let regex = /\b(the|is|are|at|in|on|a|to|was|were|did|do|does|it|my|your|his|her|she|he|they|we|am)\b/gi;
        let qText = item.en.replace(regex, "_______");
        if(qText === item.en) {
            let words = item.en.split(' ');
            let longest = words.reduce((a, b) => a.length > b.length ? a : b);
            qText = item.en.replace(longest, "_______");
        }
        return {type:"Fill Blank", q:qText, a:item.en};
    }
    // FIX logic: quita 'ing' o cambia vocal
    let fixQ = item.en.replace(/\b(wearing|talking|drinking|eating|reading|taking|listening|drawing|writing|swimming|jumping|running|dancing)\b/gi, (match) => match.slice(0, -3));
    if(fixQ === item.en) fixQ = item.en.replace(/[aeiou]/i, "x");
    return {type:"Fix Error", q:fixQ, a:item.en};
}

function showAns() { clearInterval(timerInt); document.getElementById('ans').style.display='block'; document.getElementById('rev').style.display='none'; document.getElementById('acts').style.display='flex'; }
function handleResult(c) { if(c) teamScores[activeTeam]+=10; nextTurn(); }

function handleSpecial(type, content) {
    if(type==='swap') { 
        [teamScores[0], teamScores[1]] = [teamScores[1], teamScores[0]];
        content.innerHTML = `<div style="font-size:3rem">üîÑ</div><h2 style="font-family:'Fredoka One'; color:var(--peach);">SWAP POINTS!</h2><button class="btn-reveal" onclick="nextTurn()">OK</button>`;
    } else if(type==='win10') {
        teamScores[activeTeam]+=10;
        content.innerHTML = `<div style="font-size:3rem">‚ú®</div><h2 style="font-family:'Fredoka One'; color:var(--mint);">WIN 10 POINTS!</h2><button class="btn-reveal" onclick="nextTurn()">AWESOME!</button>`;
    } else if(type==='win25') {
        teamScores[activeTeam]+=25;
        content.innerHTML = `<div style="font-size:3rem">‚≠ê</div><h2 style="font-family:'Fredoka One'; color:var(--mint);">WIN 25 POINTS!</h2><button class="btn-reveal" onclick="nextTurn()">JACKPOT!</button>`;
    } else if(type==='give') {
        content.innerHTML = `<div style="font-size:3rem">üéÅ</div><h2 style="font-family:'Fredoka One'; color:var(--peach);">GIVE POINTS!</h2><p>Choose amount to give to other team:</p>
            <div style="display:flex; gap:10px; justify-content:center; margin-top:15px;">
                ${[5,10,15,20].map(p => `<button class="btn-reveal" style="width:auto; padding:10px 20px" onclick="givePoints(${p})">${p}</button>`).join('')}
            </div>`;
    }
}

function givePoints(p) { teamScores[activeTeam===0?1:0]+=p; nextTurn(); }
function nextTurn() { document.getElementById('modal').style.display='none'; document.getElementById('timer-container').style.display='none'; if(cardsOpened>=20) endGame(); else { activeTeam=activeTeam===0?1:0; updateUI(); } }
function updateUI() { document.getElementById('s1').innerText=teamScores[0]; document.getElementById('s2').innerText=teamScores[1]; document.getElementById('t1').className='team-box'+(activeTeam===0?' active':''); document.getElementById('t2').className='team-box'+(activeTeam===1?' active':''); }

function endGame() {
    document.getElementById('game-screen').style.display='none';
    document.getElementById('end-game').style.display='block';
    const win = teamScores[0] > teamScores[1] ? 0 : 1;
    document.getElementById('winnerName').innerText = teamScores[0] === teamScores[1] ? "DRAW!" : `TEAM ${win+1} WINS!`;
    document.getElementById('winMascot').innerText = teamScores[0] === teamScores[1] ? "ü§ù" : teamChoices[win];
    document.getElementById('finalScore').innerText = `${teamScores[0]} - ${teamScores[1]}`;
}

initSetup();
</script>
</body>
</html>